#!/bin/bash
# This is a template Makefile generated by rpcgen

# Parameters

CC = gcc
CXX = g++

CLIENT = client
SERVER = server

SOURCES_CLNT.c = client.c
SOURCES_SVC.c = server.c
SOURCES.x = proto.x

PROTO_XDR.c = proto_xdr.c 
PROTO_SVC.c = proto_svc.c  
PROTO_CLNT.c = proto_clnt.c 
PROTO = proto.h proto_xdr.c proto_clnt.c proto_svc.c

TARGETS = $(CLIENT) $(SERVER)

OBJECTS_XDR = $(PROTO_XDR.c:%.c=%.o)
OBJECTS_CLNT = $(OBJECTS_XDR) $(SOURCES_CLNT.c:%.c=%.o) $(PROTO_CLNT.c:%.c=%.o)
OBJECTS_SVC = $(OBJECTS_XDR) $(SOURCES_SVC.c:%.c=%.o) $(PROTO_SVC.c:%.c=%.o)
OBJECTS = $(OBJECTS_XDR) $(SOURCES_CLNT.c:%.c=%.o) $(PROTO_CLNT.c:%.c=%.o) \
$(SOURCES_SVC.c:%.c=%.o) $(PROTO_SVC.c:%.c=%.o)

# Compiler flags 
CXXFLAGS += -D_REENTRANT -DDEBUG
CFLAGS += -g 
LDFLAGS = 
LDLIBS += -lnsl -lpthread 
RPCGENFLAGS = -M
LINK.c = $(CC) $(CFLAGS) $(CXXFLAGS) $(LDFALGS)
LINK.cc = $(CXX) $(CFLAGS) $(CXXFLAGS) $(LDFLAGS)

# TARGETS 
.PHONY: all
all : $(TARGETS)
	@echo "make all"

$(PROTO) : $(SOURCES.x) 
	@echo "@PROTO"
	rpcgen $(RPCGENFLAGS) $(SOURCES.x)	

$(CLIENT) : $(OBJECTS_CLNT) 
	@echo "@CLIENT"
	$(LINK.c) -o $(CLIENT) $(OBJECTS_CLNT) $(LDLIBS) 

$(SERVER) : $(OBJECTS_SVC) 
	@echo "@SERVER"
	$(LINK.c) -o $(SERVER) $(OBJECTS_SVC) $(LDLIBS)

$(OBJECTS) : %.o: %.c
	@echo "@(OBJECTS)"
	$(LINK.c) -c $< -o $@
	 
.PHONY: clean
clean:
	@echo "@make clean"
	rm -f *.o $(PROTO) $(OBJECTS) $(CLIENT) $(SERVER)

